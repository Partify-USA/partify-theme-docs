"use strict";(globalThis.webpackChunkpartify_usa=globalThis.webpackChunkpartify_usa||[]).push([[1007],{8212(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"pages/order-status-tracking/sql-order-gcr","title":"Order Status Production Sync (Google Cloud Run)","description":"Google Cloud Run job that reads open orders from Google Sheets, aggregates scan data in PostgreSQL, formats Shopify metafields in SQL, and writes a Shopify-import-compatible sheet.","source":"@site/docs/pages/order-status-tracking/sql-order-gcr.md","sourceDirName":"pages/order-status-tracking","slug":"/pages/order-status-tracking/sql-order-gcr","permalink":"/partify-theme-docs/docs/pages/order-status-tracking/sql-order-gcr","draft":false,"unlisted":false,"editUrl":"https://github.com/partify/partify-theme-docs/tree/main/docs/pages/order-status-tracking/sql-order-gcr.md","tags":[],"version":"current","frontMatter":{"title":"Order Status Production Sync (Google Cloud Run)","description":"Google Cloud Run job that reads open orders from Google Sheets, aggregates scan data in PostgreSQL, formats Shopify metafields in SQL, and writes a Shopify-import-compatible sheet."},"sidebar":"tutorialSidebar","previous":{"title":"Order Status Tracking","permalink":"/partify-theme-docs/docs/category/order-status-tracking"},"next":{"title":"Product Page","permalink":"/partify-theme-docs/docs/category/product-page"}}');var r=s(4848),l=s(8453);const t={title:"Order Status Production Sync (Google Cloud Run)",description:"Google Cloud Run job that reads open orders from Google Sheets, aggregates scan data in PostgreSQL, formats Shopify metafields in SQL, and writes a Shopify-import-compatible sheet."},o=void 0,d={},a=[{value:"Purpose",id:"purpose",level:2},{value:"Scope of Responsibility",id:"scope-of-responsibility",level:2},{value:"Owns",id:"owns",level:3},{value:"Does Not Own",id:"does-not-own",level:3},{value:"Data In",id:"data-in",level:2},{value:"Data Out / Side Effects",id:"data-out--side-effects",level:2},{value:"Key Logic Areas",id:"key-logic-areas",level:2},{value:"HTTP Entry Point and Execution Model",id:"http-entry-point-and-execution-model",level:3},{value:"Order Ingestion and Normalization (Google Sheets)",id:"order-ingestion-and-normalization-google-sheets",level:3},{value:"Warehouse Query and Order/SKU Correlation (PostgreSQL)",id:"warehouse-query-and-ordersku-correlation-postgresql",level:3},{value:"Latest Scan Selection per Base Order / SKU / Step",id:"latest-scan-selection-per-base-order--sku--step",level:3},{value:"Metafield Construction and Step Mapping (SQL Only)",id:"metafield-construction-and-step-mapping-sql-only",level:3},{value:"Output Sheet Layout and Overwrite Behavior",id:"output-sheet-layout-and-overwrite-behavior",level:3},{value:"Service Lifecycle and Resource Management",id:"service-lifecycle-and-resource-management",level:3},{value:"High-Level Flow Diagram",id:"high-level-flow-diagram",level:2},{value:"Known Constraints &amp; Gotchas",id:"known-constraints--gotchas",level:2},{value:"Safe to Change",id:"safe-to-change",level:2},{value:"Dangerous to Change",id:"dangerous-to-change",level:2},{value:"Related Files",id:"related-files",level:2},{value:"Owner &amp; Maintenance",id:"owner--maintenance",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:"Google Cloud Run \u2013 Production Status Sync Job is an HTTP-triggered service that reads open order numbers and SKUs from a Google Sheet ('1k8j-Ki6P6AlYFTgqhD1GWJ5ikLS7LuhXrCanOKXdpIE' -- Finale Open Orders), correlates them with scan events in a PostgreSQL warehouse, builds Shopify metafield values entirely in SQL, and writes the results into a second Google Sheet ('19NnMjBGceTfzIX4XT4pb5aP_hlgp-3Guothd3iSl7Lw' -- Extracted Data from Postgres) in a Shopify-import-compatible layout."}),"\n",(0,r.jsx)(n.h2,{id:"scope-of-responsibility",children:"Scope of Responsibility"}),"\n",(0,r.jsx)(n.h3,{id:"owns",children:"Owns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Reading open order identifiers and SKUs from the "Open Orders" Google Sheet (columns C and D)'}),"\n",(0,r.jsx)(n.li,{children:"Normalizing order numbers to a base identifier while retaining the full, lettered order for per-piece matching"}),"\n",(0,r.jsxs)(n.li,{children:["Connecting to PostgreSQL using ",(0,r.jsx)(n.code,{children:"dbConfig.json"})," and querying the ",(0,r.jsx)(n.code,{children:"scans"})," table"]}),"\n",(0,r.jsx)(n.li,{children:"Aggregating latest scan timestamps per base order, per-SKU, and workflow step"}),"\n",(0,r.jsx)(n.li,{children:"Building production status and step-specific metafield strings (prepared, painted, packaged, shipped) in SQL"}),"\n",(0,r.jsx)(n.li,{children:"Writing fully formatted rows to the output Google Sheet in the exact layout required by Shopify metafield import"}),"\n",(0,r.jsx)(n.li,{children:"Clearing and repopulating the output sheet on every run"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"does-not-own",children:"Does Not Own"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Scheduling or triggering of the job (this is handled by the Cloud Scheduler cron ",(0,r.jsx)(n.code,{children:"sql-order-status-sync-sheets"})," -- can be found in Google Cloud by searching Cloud Scheduler)"]}),"\n",(0,r.jsx)(n.li,{children:"Shopify metafield import itself (this is handled by matrixify every 15 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"Maintenance of the PostgreSQL warehouse schema or upstream scan ingestion"}),"\n",(0,r.jsx)(n.li,{children:"Business definitions of workflow steps or their naming conventions"}),"\n",(0,r.jsx)(n.li,{children:"Shopify theme rendering of metafield values or storefront behavior"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"data-in",children:"Data In"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Google Sheet: ",(0,r.jsx)(n.code,{children:"Open Orders!C:D"})," from spreadsheet ",(0,r.jsx)(n.code,{children:"1k8j-Ki6P6AlYFTgqhD1GWJ5ikLS7LuhXrCanOKXdpIE"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Column C contains open order numbers with suffix letters and optional slash segments (for example ",(0,r.jsx)(n.code,{children:"U162378A/1"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Column D contains the trusted SKU for that specific lettered order (for example ",(0,r.jsx)(n.code,{children:"GM1230469C.WA8624"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["PostgreSQL warehouse:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Table ",(0,r.jsx)(n.code,{children:"scans"})," from ",(0,r.jsx)(n.code,{children:"Warehouse"})," db with fields including ",(0,r.jsx)(n.code,{children:"OrderNumber"}),", ",(0,r.jsx)(n.code,{children:"StartTime"}),", ",(0,r.jsx)(n.code,{children:"StepName"}),", and SKU (",(0,r.jsx)(n.code,{children:"sku"}),")"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration files and credentials:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dbConfig.json"})," for PostgreSQL connection parameters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credentials.json"})," for Google service account authentication"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["HTTP Request:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"GET /run-job"})," request to the Cloud Run service (no request body is used by the pipeline)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"data-out--side-effects",children:"Data Out / Side Effects"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Google Sheets writes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Clears all data in ",(0,r.jsx)(n.code,{children:"Sheet1"})," of spreadsheet ",(0,r.jsx)(n.code,{children:"19NnMjBGceTfzIX4XT4pb5aP_hlgp-3Guothd3iSl7Lw"})]}),"\n",(0,r.jsxs)(n.li,{children:["Writes a full replacement dataset starting at ",(0,r.jsx)(n.code,{children:"A1"}),", including header row and all computed metafields"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Network calls:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Google Sheets API (read ",(0,r.jsx)(n.code,{children:"Open Orders!C:D"}),", clear ",(0,r.jsx)(n.code,{children:"Sheet1"}),", write new rows)"]}),"\n",(0,r.jsxs)(n.li,{children:["PostgreSQL connection to run a single SQL query against the ",(0,r.jsx)(n.code,{children:"scans"})," table"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["No persistent in-service state:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The service does not store any data between runs; every execution is stateless and recomputes from source systems"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-logic-areas",children:"Key Logic Areas"}),"\n",(0,r.jsx)(n.h3,{id:"http-entry-point-and-execution-model",children:"HTTP Entry Point and Execution Model"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The only runtime entry point is the HTTP handler for ",(0,r.jsx)(n.code,{children:"GET /run-job"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'app.get("/run-job", async (req, res) => { await saveToPostgres(); });'})," invokes ",(0,r.jsx)(n.code,{children:"saveToPostgres()"})," and then returns."]}),"\n",(0,r.jsxs)(n.li,{children:["There is no internal scheduler in the service itself; execution is triggered externally by the Cloud Scheduler job ",(0,r.jsx)(n.code,{children:"sql-order-status-syunc-sheets"})," hitting ",(0,r.jsx)(n.code,{children:"/run-job"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"order-ingestion-and-normalization-google-sheets",children:"Order Ingestion and Normalization (Google Sheets)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fetchColumn()"})," reads columns C and D from ",(0,r.jsx)(n.code,{children:"Open Orders!C:D"})," using a Google service account and Google Sheets API."]}),"\n",(0,r.jsxs)(n.li,{children:["For each row, JavaScript derives:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fullOrder"})," as the order identifier trimmed of any ",(0,r.jsx)(n.code,{children:"/"})," suffix but preserving the trailing letter (for example ",(0,r.jsx)(n.code,{children:"U162378A"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"baseName"})," by stripping any trailing alphabetic characters from ",(0,r.jsx)(n.code,{children:"fullOrder"})," (for example ",(0,r.jsx)(n.code,{children:"U162378"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sku"})," as the trusted SKU from column D for that specific lettered order."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The function returns an array of ",(0,r.jsx)(n.code,{children:"{ baseName, fullOrder, sku }"})," objects, which become the authoritative mapping between base orders, lettered orders, and SKUs."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"warehouse-query-and-ordersku-correlation-postgresql",children:"Warehouse Query and Order/SKU Correlation (PostgreSQL)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"saveToPostgres()"})," opens a PostgreSQL client using ",(0,r.jsx)(n.code,{children:"dbConfig.json"})," and executes a single SQL statement against the ",(0,r.jsx)(n.code,{children:"scans"})," table."]}),"\n",(0,r.jsxs)(n.li,{children:["The query first materializes an ",(0,r.jsx)(n.code,{children:"order_skus"})," CTE from the sheet data:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"order_skus(base_name, full_order, sku) AS (VALUES (...))"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"latest_scans"})," CTE then joins ",(0,r.jsx)(n.code,{children:"order_skus"})," to ",(0,r.jsx)(n.code,{children:"scans"})," via the full, lettered order number:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"JOIN scans s ON split_part(s.\"OrderNumber\", '/', 1) = os.full_order"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["This ensures each SKU is only associated with scan rows for its own lettered order (for example ",(0,r.jsx)(n.code,{children:"U162378B"}),"), while ",(0,r.jsx)(n.code,{children:"base_name"})," (",(0,r.jsx)(n.code,{children:"U162378"}),") is kept for grouping the Shopify output."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"latest-scan-selection-per-base-order--sku--step",children:"Latest Scan Selection per Base Order / SKU / Step"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"latest_scans"})," groups scan records by:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Base order name (",(0,r.jsx)(n.code,{children:"base_name"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"SKU from the sheet"}),"\n",(0,r.jsx)(n.li,{children:"Step name"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["For each (base order, SKU, step) combination, the query computes:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'MAX(s."StartTime") AS latest_time'})," per SKU and step."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["The final ",(0,r.jsx)(n.code,{children:"SELECT"})," aggregates over ",(0,r.jsx)(n.code,{children:"base_name"})," only, yielding one output row per base order while still preserving per-SKU timestamps inside the metafield strings."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"metafield-construction-and-step-mapping-sql-only",children:"Metafield Construction and Step Mapping (SQL Only)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All metafield formatting happens inside the SQL query; JavaScript only passes parameters and forwards results."}),"\n",(0,r.jsxs)(n.li,{children:["Base value format used for each status entry:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"CONCAT(l.\"sku\", '_', to_char(l.latest_time AT TIME ZONE 'UTC' AT TIME ZONE 'America/New_York', 'HH12:MI AM MM-DD-YYYY'))"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Timezone handling:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Timestamps are converted from UTC to ",(0,r.jsx)(n.code,{children:"America/New_York"})," before formatting."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Step-to-metafield mapping is enforced entirely in SQL:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prepared: ",(0,r.jsx)(n.code,{children:"'PrepUS - Prepara', 'PrepCA'"})]}),"\n",(0,r.jsxs)(n.li,{children:["Painted: ",(0,r.jsx)(n.code,{children:"'PaintUS - Pintar', 'PaintCA', 'ClearUS'"})]}),"\n",(0,r.jsxs)(n.li,{children:["Packaged: ",(0,r.jsx)(n.code,{children:"'PackUS - Embalar', 'PackCA'"})]}),"\n",(0,r.jsxs)(n.li,{children:["Shipped: ",(0,r.jsx)(n.code,{children:"'Warren Ship', 'Loading FedEx - USA', 'Loading RL', 'Loading SAIA', 'Loading RoadRunner', 'BoxCA', 'Loading FedEx - Canada', 'Loading Canpar'"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"STRING_AGG(DISTINCT ..., ', ')"})," is used to combine multiple step entries into a single, comma-separated string for each metafield column."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"production_status"})," includes all step categories, while the four status_* metafields include only their respective step groups."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"output-sheet-layout-and-overwrite-behavior",children:"Output Sheet Layout and Overwrite Behavior"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Before writing, the job clears ",(0,r.jsx)(n.code,{children:"Sheet1"})," completely using ",(0,r.jsx)(n.code,{children:"sheets.spreadsheets.values.clear"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["It then writes headers and data rows in a fixed column order:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Name"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SKU"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Command"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Metafield: custom.production_status [multi_line_text_field]"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Metafield: custom.status_shipped [list.single_line_text_field]"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Metafield: custom.status_packaged [list.single_line_text_field]"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Metafield: custom.status_painted [list.single_line_text_field]"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Metafield: custom.status_prepared [list.single_line_text_field]"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Each result row is written as:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"[row.name, row.sku, row.command, row.production_status, row.status_shipped, row.status_packaged, row.status_painted, row.status_prepared]"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Because the sheet is cleared first, each run fully replaces prior data and is effectively idempotent relative to source systems."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-lifecycle-and-resource-management",children:"Service Lifecycle and Resource Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["After the SQL query completes and ",(0,r.jsx)(n.code,{children:"writeToSheet(result.rows)"})," finishes, the PostgreSQL connection is closed."]}),"\n",(0,r.jsx)(n.li,{children:"The HTTP request then completes; no background work continues after the response is sent."}),"\n",(0,r.jsx)(n.li,{children:"The Cloud Run instance holds no persistent state; each invocation is independent."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"high-level-flow-diagram",children:"High-Level Flow Diagram"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Cloud Scheduler calls HTTP ",(0,r.jsx)(n.code,{children:"GET /run-job"})," -- hits the Cloud Run service."]}),"\n",(0,r.jsxs)(n.li,{children:["Service authenticates to Google Sheets using the service account from ",(0,r.jsx)(n.code,{children:"credentials.json"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"fetchColumn()"})," reads ",(0,r.jsx)(n.code,{children:"Open Orders!C:C"})," and normalizes order numbers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"saveToPostgres()"})," connects to PostgreSQL using ",(0,r.jsx)(n.code,{children:"dbConfig.json"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["SQL query normalizes ",(0,r.jsx)(n.code,{children:"OrderNumber"}),", filters to the open-order list, computes latest scans per (order, SKU, step), and builds metafield strings."]}),"\n",(0,r.jsxs)(n.li,{children:["Query results are mapped into the Shopify import layout and passed to ",(0,r.jsx)(n.code,{children:"writeToSheet()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Output ",(0,r.jsx)(n.code,{children:"Sheet1"})," is cleared and rewritten with the new headers and data."]}),"\n",(0,r.jsx)(n.li,{children:"PostgreSQL connection is closed; HTTP response completes; service remains idle until the next call."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Cloud Scheduler --\x3e saveToPostgres() (gcr function) --\x3e Extracted Data from Postgres (Sheets) --\x3e matrixify upload to shopify"}),"\n",(0,r.jsx)(n.h2,{id:"known-constraints--gotchas",children:"Known Constraints & Gotchas"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["No internal scheduling:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The job only runs when ",(0,r.jsx)(n.code,{children:"GET /run-job"})," is called by an external system (Cloud Scheduler)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Duplicated order normalization logic:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Normalization runs in both JavaScript and SQL; these rules must stay in sync to avoid data mismatches."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Strict dependence on step names:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Step-to-metafield mapping relies on exact ",(0,r.jsx)(n.code,{children:"StepName"})," strings; any upstream renames will silently break categorizations."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["SQL-only formatting:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timestamp format, SKU delimiter, and metafield structure are all encoded in SQL; JavaScript must not reformat these values."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Full sheet overwrite:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Every run clears ",(0,r.jsx)(n.code,{children:"Sheet1"})," entirely; any manual edits or auxiliary data in that sheet will be lost."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Timezone assumptions:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["All timestamps are presented in ",(0,r.jsx)(n.code,{children:"America/New_York"}),"; consumers must not assume UTC."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Filtered orders only:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Orders with no qualifying workflow steps (per the configured step lists) are excluded from the final result set."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"safe-to-change",children:"Safe to Change"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Logging and error reporting around Google Sheets and PostgreSQL calls."}),"\n",(0,r.jsxs)(n.li,{children:["Non-functional refactors inside ",(0,r.jsx)(n.code,{children:"saveToPostgres()"})," and related helpers that do not alter SQL semantics or I/O contracts."]}),"\n",(0,r.jsx)(n.li,{children:"Adding additional, clearly non-Shopify columns to the output (e.g., debug-only columns), provided downstream import tooling explicitly ignores them."}),"\n",(0,r.jsx)(n.li,{children:"HTTP response messaging and basic observability (e.g., returning simple summaries of processed order counts)."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dangerous-to-change",children:"Dangerous to Change"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Order normalization rules in either JavaScript or SQL (",(0,r.jsx)(n.code,{children:"split('/')"})," and trailing-letter removal)."]}),"\n",(0,r.jsx)(n.li,{children:"SQL that constructs metafield values, including timestamp format, SKU delimiter, and timezone conversion."}),"\n",(0,r.jsxs)(n.li,{children:["The mapping of ",(0,r.jsx)(n.code,{children:"StepName"})," values into prepared/painted/packaged/shipped/production_status metafields."]}),"\n",(0,r.jsxs)(n.li,{children:["Spreadsheet IDs, sheet names (",(0,r.jsx)(n.code,{children:"Open Orders"}),", ",(0,r.jsx)(n.code,{children:"Sheet1"}),"), and the exact header labels and column ordering expected by Shopify import."]}),"\n",(0,r.jsxs)(n.li,{children:["Clearing behavior for ",(0,r.jsx)(n.code,{children:"Sheet1"}),"; partial clears or appends can break downstream import expectations."]}),"\n",(0,r.jsxs)(n.li,{children:["Authentication configuration for the Google service account, scopes, or the location of ",(0,r.jsx)(n.code,{children:"credentials.json"})," and ",(0,r.jsx)(n.code,{children:"dbConfig.json"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-files",children:"Related Files"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dbConfig.json"})," (PostgreSQL connection configuration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"credentials.json"})," (Google Sheets service account credentials)"]}),"\n",(0,r.jsxs)(n.li,{children:["Cloud Run service source file that defines ",(0,r.jsx)(n.code,{children:'app.get("/run-job")'})," and ",(0,r.jsx)(n.code,{children:"saveToPostgres()"})]}),"\n",(0,r.jsx)(n.li,{children:"Infrastructure configuration that wires the public URL of this Cloud Run service into Cloud Scheduler or other external triggers"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"owner--maintenance",children:"Owner & Maintenance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Owner:"})," Wyatt Chamberlin"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last Updated:"})," 2026-02-02"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);