"use strict";(globalThis.webpackChunkpartify_usa=globalThis.webpackChunkpartify_usa||[]).push([[2038],{2919(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"backend/add-endpoints","title":"Adding New Endpoints","description":"Step-by-step process on how to add new endpoints to the Finale Webhook backend","source":"@site/docs/backend/add-endpoints.md","sourceDirName":"backend","slug":"/backend/add-endpoints","permalink":"/partify-theme-docs/docs/backend/add-endpoints","draft":false,"unlisted":false,"editUrl":"https://github.com/partify/partify-theme-docs/tree/main/docs/backend/add-endpoints.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Adding New Endpoints","description":"Step-by-step process on how to add new endpoints to the Finale Webhook backend","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Getting Set Up","permalink":"/partify-theme-docs/docs/backend/setup"},"next":{"title":"Contribution","permalink":"/partify-theme-docs/docs/category/contribution"}}');var o=t(4848),i=t(8453);const r={title:"Adding New Endpoints",description:"Step-by-step process on how to add new endpoints to the Finale Webhook backend",sidebar_position:2},d="Guide: Adding New Webhook Endpoints",a={},l=[{value:"\ud83d\udccb Overview",id:"-overview",level:2},{value:"\ud83d\udee0\ufe0f Step-by-Step: Adding a New Endpoint",id:"\ufe0f-step-by-step-adding-a-new-endpoint",level:2},{value:"Step 1: Create the Route File",id:"step-1-create-the-route-file",level:3},{value:"Step 2: Register the Route in server.js",id:"step-2-register-the-route-in-serverjs",level:3},{value:"Step 3: Add Tests",id:"step-3-add-tests",level:3},{value:"Step 4: Test Locally",id:"step-4-test-locally",level:3},{value:"Step 5: Commit Your Changes",id:"step-5-commit-your-changes",level:3},{value:"Step 6: Deploy to Production",id:"step-6-deploy-to-production",level:3},{value:"\ud83d\udd10 Environment Variables",id:"-environment-variables",level:2},{value:"\u2705 Checklist for New Endpoints",id:"-checklist-for-new-endpoints",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"guide-adding-new-webhook-endpoints",children:"Guide: Adding New Webhook Endpoints"})}),"\n",(0,o.jsx)(n.p,{children:"This guide walks you through creating new webhook endpoints in the Finale Webhooks service."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-overview",children:"\ud83d\udccb Overview"}),"\n",(0,o.jsx)(n.p,{children:"The service is organized like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"finale-webhooks/\n\u251c\u2500\u2500 server.js                    # Main app - register routes here\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 routes/                  # Endpoint handlers (one file per endpoint)\n\u2502   \u2502   \u251c\u2500\u2500 damage.js           # Example: damage webhook\n\u2502   \u2502   \u2514\u2500\u2500 inventory.js        # Example: your new endpoint\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u2514\u2500\u2500 finale.js           # Shared Finale API utilities\n\u2514\u2500\u2500 test.http                   # Tests for all endpoints\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Pattern:"})," One route file = One endpoint"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"\ufe0f-step-by-step-adding-a-new-endpoint",children:"\ud83d\udee0\ufe0f Step-by-Step: Adding a New Endpoint"}),"\n",(0,o.jsxs)(n.p,{children:["Let's say you want to add an inventory update webhook at ",(0,o.jsx)(n.code,{children:"/webhook/inventory"}),"."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-1-create-the-route-file",children:"Step 1: Create the Route File"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Create:"})," ",(0,o.jsx)(n.code,{children:"src/routes/inventory.js"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'/**\n * Inventory webhook route handler\n * Description of what this endpoint does\n */\n\nconst express = require("express");\nconst router = express.Router();\nconst { createFinaleConfig, finaleGet, randomId } = require("../utils/finale");\n\n/**\n * POST /webhook/inventory\n * Description of endpoint\n *\n * Body: {\n *   productId: "SKU123",\n *   quantity: 10,\n *   facilityId: "12345"\n * }\n */\nrouter.post("/", async (req, res) => {\n\tconst execId = `INV_EXEC_${new Date().toISOString()}_${randomId()}`;\n\n\ttry {\n\t\t// 1. Validate input\n\t\tconst { productId, quantity, facilityId } = req.body;\n\n\t\tif (!productId) {\n\t\t\treturn res.status(400).json({\n\t\t\t\tok: false,\n\t\t\t\texecId,\n\t\t\t\terror: "productId required",\n\t\t\t});\n\t\t}\n\n\t\tconsole.log(`[${execId}] Processing inventory update for ${productId}`);\n\n\t\t// 2. Your business logic here\n\t\tconst result = await handleInventoryUpdate({\n\t\t\tproductId,\n\t\t\tquantity,\n\t\t\tfacilityId,\n\t\t});\n\n\t\t// 3. Return response\n\t\tres.status(200).json({\n\t\t\tok: true,\n\t\t\texecId,\n\t\t\tresult,\n\t\t});\n\t} catch (err) {\n\t\tconsole.error(`[${execId}] Error:`, err);\n\t\tres.status(500).json({\n\t\t\tok: false,\n\t\t\texecId,\n\t\t\terror: err.message || String(err),\n\t\t});\n\t}\n});\n\n/**\n * Core business logic\n */\nasync function handleInventoryUpdate(params) {\n\tconst { productId, quantity, facilityId } = params;\n\n\t// Get Finale configuration (US or CA based on your needs)\n\tconst cfg = createFinaleConfig("US");\n\n\t// Make API calls, process data, etc.\n\t// Example: fetch product info\n\tconst productUrl = cfg.productUrl(productId);\n\tconst productRes = await finaleGet(cfg, productUrl);\n\n\tif (productRes.code !== 200) {\n\t\tthrow new Error("Product not found");\n\t}\n\n\t// Your logic here...\n\n\treturn {\n\t\tproductId,\n\t\tupdatedQuantity: quantity,\n\t\tstatus: "success",\n\t};\n}\n\nmodule.exports = router;\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-2-register-the-route-in-serverjs",children:"Step 2: Register the Route in server.js"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Edit:"})," ",(0,o.jsx)(n.code,{children:"server.js"})]}),"\n",(0,o.jsx)(n.p,{children:"Add these lines:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'// At the top with other requires\nconst inventoryRoute = require("./src/routes/inventory");\n\n// After other app.use() lines\napp.use("/webhook/inventory", inventoryRoute);\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Full example:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:'require("dotenv").config();\nconst express = require("express");\nconst damageRoute = require("./src/routes/damage");\nconst inventoryRoute = require("./src/routes/inventory"); // \u2190 Add this\n\nconst app = express();\nconst PORT = process.env.PORT || 8080;\n\napp.use(express.json());\n\n// ... logging middleware ...\n\napp.get("/", (req, res) => {\n\tres.json({\n\t\tstatus: "ok",\n\t\tservice: "finale-webhooks",\n\t\ttimestamp: new Date().toISOString(),\n\t\tendpoints: [\n\t\t\t"POST /webhook/damage - Create damaged replacement order",\n\t\t\t"POST /webhook/inventory - Update inventory", // \u2190 Update this list\n\t\t],\n\t});\n});\n\napp.use("/webhook/damage", damageRoute);\napp.use("/webhook/inventory", inventoryRoute); // \u2190 Add this\n\n// ... error handlers ...\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-3-add-tests",children:"Step 3: Add Tests"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Edit:"})," ",(0,o.jsx)(n.code,{children:"test.http"})]}),"\n",(0,o.jsx)(n.p,{children:"Add your test cases:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-http",children:'### Test Inventory Webhook - Success Case\nPOST http://localhost:8080/webhook/inventory\nContent-Type: application/json\n\n{\n  "productId": "SKU123",\n  "quantity": 10,\n  "facilityId": "12345"\n}\n\n### Test Inventory Webhook - Missing productId (should fail)\nPOST http://localhost:8080/webhook/inventory\nContent-Type: application/json\n\n{\n  "quantity": 10\n}\n\n### Test Inventory Webhook - Production\nPOST https://finale-webhooks-648477666631.us-central1.run.app/webhook/inventory\nContent-Type: application/json\n\n{\n  "productId": "REAL-SKU-HERE",\n  "quantity": 5,\n  "facilityId": "100730"\n}\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-4-test-locally",children:"Step 4: Test Locally"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:"# Start the server\nnpm start\n"})}),"\n",(0,o.jsx)(n.p,{children:"In VS Code:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Open ",(0,o.jsx)(n.code,{children:"test.http"})]}),"\n",(0,o.jsx)(n.li,{children:'Click "Send Request" above your new test'}),"\n",(0,o.jsx)(n.li,{children:"Check the response"}),"\n",(0,o.jsxs)(n.li,{children:["Check console logs for your ",(0,o.jsx)(n.code,{children:"console.log()"})," messages"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-5-commit-your-changes",children:"Step 5: Commit Your Changes"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:'git pull --rebase origin main\ngit add .\ngit commit -m "Add inventory webhook endpoint"\ngit push origin main\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"step-6-deploy-to-production",children:"Step 6: Deploy to Production"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:"gcloud run deploy finale-webhooks `\n  --source . `\n  --region us-central1 `\n  --allow-unauthenticated `\n  --platform managed\n"})}),"\n",(0,o.jsx)(n.p,{children:"Wait for deployment to complete (2-5 minutes)."}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-environment-variables",children:"\ud83d\udd10 Environment Variables"}),"\n",(0,o.jsx)(n.p,{children:"Access environment variables in your route:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-javascript",children:"const myConfig = process.env.MY_CONFIG_VALUE;\nconst usStore = process.env.FINALE_US_STORE;\n"})}),"\n",(0,o.jsx)(n.p,{children:"To add new environment variables:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["Add to ",(0,o.jsx)(n.code,{children:".env.example"})]})," (template for team)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["Add to your ",(0,o.jsx)(n.code,{children:".env"})]})," (your local values)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Add to Cloud Run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-powershell",children:'gcloud run services update finale-webhooks `\n  --region us-central1 `\n  --set-env-vars "MY_CONFIG_VALUE=my-value"\n'})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"-checklist-for-new-endpoints",children:"\u2705 Checklist for New Endpoints"}),"\n",(0,o.jsx)(n.p,{children:"Before submitting a PR:"}),"\n",(0,o.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Created route file in ",(0,o.jsx)(n.code,{children:"src/routes/"})]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Registered route in ",(0,o.jsx)(n.code,{children:"server.js"})]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Added endpoint to health check endpoint list"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Added tests in ",(0,o.jsx)(n.code,{children:"test.http"})]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tested locally with ",(0,o.jsx)(n.code,{children:"npm start"})]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Added proper error handling"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Committed and pushed to GitHub"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Deployed to Cloud Run"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tested in production"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Updated documentation if needed"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.p,{children:"Happy coding! \ud83d\ude80"})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>d});var s=t(6540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);