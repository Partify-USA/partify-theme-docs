"use strict";(globalThis.webpackChunkpartify_usa=globalThis.webpackChunkpartify_usa||[]).push([[3021],{8453(e,s,n){n.d(s,{R:()=>l,x:()=>t});var i=n(6540);const r={},c=i.createContext(r);function l(e){const s=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(c.Provider,{value:s},e.children)}},9919(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"frontend/global-components/navbar/predictive_searchbar","title":"Search Bar","description":"Vehicle-scoped predictive search in the global navbar with dual search strategies (Shopify Predictive Search API + Fuse.js) and EasySearch vehicle integration.","source":"@site/docs/frontend/global-components/navbar/predictive_searchbar.md","sourceDirName":"frontend/global-components/navbar","slug":"/frontend/global-components/navbar/predictive_searchbar","permalink":"/partify-theme-docs/docs/frontend/global-components/navbar/predictive_searchbar","draft":false,"unlisted":false,"editUrl":"https://github.com/partify/partify-theme-docs/tree/main/docs/frontend/global-components/navbar/predictive_searchbar.md","tags":[],"version":"current","frontMatter":{"title":"Search Bar","description":"Vehicle-scoped predictive search in the global navbar with dual search strategies (Shopify Predictive Search API + Fuse.js) and EasySearch vehicle integration."},"sidebar":"tutorialSidebar","previous":{"title":"Navbar Components","permalink":"/partify-theme-docs/docs/category/navbar-components"},"next":{"title":"Backend","permalink":"/partify-theme-docs/docs/category/backend"}}');var r=n(4848),c=n(8453);const l={title:"Search Bar",description:"Vehicle-scoped predictive search in the global navbar with dual search strategies (Shopify Predictive Search API + Fuse.js) and EasySearch vehicle integration."},t=void 0,a={},d=[{value:"Purpose",id:"purpose",level:2},{value:"Scope of Responsibility",id:"scope-of-responsibility",level:2},{value:"Owns",id:"owns",level:3},{value:"Does Not Own",id:"does-not-own",level:3},{value:"Data In",id:"data-in",level:2},{value:"Data Out / Side Effects",id:"data-out--side-effects",level:2},{value:"Key Logic Areas",id:"key-logic-areas",level:2},{value:"Search Strategy: Two Different Approaches",id:"search-strategy-two-different-approaches",level:3},{value:"Header Integration and Markup",id:"header-integration-and-markup",level:3},{value:"Predictive Search Section (Server-Side)",id:"predictive-search-section-server-side",level:3},{value:"Client-Side Predictive Search Behavior",id:"client-side-predictive-search-behavior",level:3},{value:"Vehicle-Scoped Fitment Filtering",id:"vehicle-scoped-fitment-filtering",level:3},{value:"Search Submission, URLs, and Logging",id:"search-submission-urls-and-logging",level:3},{value:"High-Level Flow Diagram",id:"high-level-flow-diagram",level:2},{value:"Known Constraints &amp; Gotchas",id:"known-constraints--gotchas",level:2},{value:"Safe to Change",id:"safe-to-change",level:2},{value:"Dangerous to Change",id:"dangerous-to-change",level:2},{value:"Related Files",id:"related-files",level:2},{value:"Owner &amp; Maintenance",id:"owner--maintenance",level:2}];function o(e){const s={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsxs)(s.p,{children:["The header predictive search bar lets customers search for parts while automatically scoping results to their selected vehicle (via EasySearch). It implements two search strategies: ",(0,r.jsx)(s.strong,{children:"Shopify Predictive Search API"})," for broad searches (no vehicle or SKU queries) and ",(0,r.jsx)(s.strong,{children:"Fuse.js"})," for vehicle-scoped fuzzy searches. This replaces the theme's generic live search behavior with a vehicle-aware, fitment-first experience."]}),"\n",(0,r.jsx)(s.h2,{id:"scope-of-responsibility",children:"Scope of Responsibility"}),"\n",(0,r.jsx)(s.h3,{id:"owns",children:"Owns"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Rendering the header search input and results container in the navbar"}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Dual search strategy implementation:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Calling Shopify Predictive Search API (",(0,r.jsx)(s.code,{children:"searchAllProducts()"}),") for broad searches"]}),"\n",(0,r.jsxs)(s.li,{children:["Calling Shopify Collections API + Fuse.js (",(0,r.jsx)(s.code,{children:"searchInCollection()"}),") for vehicle-scoped fuzzy searches"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"Applying vehicle fitment filtering based on EasySearch-selected vehicle"}),"\n",(0,r.jsx)(s.li,{children:"Showing vehicle-related messaging (no vehicle selected, no fitment matches)"}),"\n",(0,r.jsx)(s.li,{children:"Handling search submission behavior (including redirects and logging)"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"does-not-own",children:"Does Not Own"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"How a vehicle is selected or stored (owned by the EasySearch garage integration)"}),"\n",(0,r.jsx)(s.li,{children:"Product card layout, pricing, and stock logic (shared product snippets)"}),"\n",(0,r.jsx)(s.li,{children:"Global header layout, logo, menus, and cart behavior"}),"\n",(0,r.jsxs)(s.li,{children:["Core search results page layout at ",(0,r.jsx)(s.code,{children:"/search"})," (static search templates)"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"data-in",children:"Data In"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Shopify objects"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"predictive_search"})," section data (products, collections, pages, articles, queries)"]}),"\n",(0,r.jsx)(s.li,{children:"Product data used inside predictive search results (title, images, variants, collections)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Metafields"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"product.metafields.custom.collection_types"})," (serialized and output as ",(0,r.jsx)(s.code,{children:"data-collection-types"})," on each predictive search product result)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"LocalStorage / App state"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"localStorage.searchTerms"})," from EasySearch / garage (provides selected vehicle YMM and related metadata)"]}),"\n",(0,r.jsx)(s.li,{children:"EasySearch vehicle selection UI (via the garage components rendered in the header)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Theme settings"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Header settings that enable live search and control whether the mobile search bar is visible"}),"\n",(0,r.jsx)(s.li,{children:"Storefront money format and translation strings used inside predictive search templates"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"data-out--side-effects",children:"Data Out / Side Effects"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"DOM mutations"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Injects predictive search HTML into the header results container under the search bar"}),"\n",(0,r.jsx)(s.li,{children:"Shows/hides the results flyout, loading skeleton, error messages, and vehicle reminders"}),"\n",(0,r.jsxs)(s.li,{children:["Filters individual product ",(0,r.jsx)(s.code,{children:"<li>"})," elements based on vehicle fitment metadata"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Global state and exports"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Exposes a predictive search API on ",(0,r.jsx)(s.code,{children:"window"})," for initialization and debugging"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Network calls"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["For ",(0,r.jsx)(s.code,{children:"searchAllProducts()"}),":"]})," Calls Shopify Predictive Search API at ",(0,r.jsx)(s.code,{children:"/search/suggest?section_id=predictive-search"})," to fetch server-rendered HTML with products and suggestions"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["For ",(0,r.jsx)(s.code,{children:"searchInCollection()"}),":"]})," Calls Shopify Collections API at ",(0,r.jsx)(s.code,{children:"/collections/{handle}/products.json"})," to fetch JSON product data, then uses Fuse.js client-side for fuzzy matching"]}),"\n",(0,r.jsx)(s.li,{children:"Calls Shopify GraphQL Storefront API to enrich vehicle-scoped products with collection type metadata used for URL filtering"}),"\n",(0,r.jsxs)(s.li,{children:["Sends search telemetry to Google Sheets via ",(0,r.jsx)(s.code,{children:"navigator.sendBeacon"})," for analytics (query, vehicle, matches, selected product)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Navigation"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:'Redirects to full search results pages or vehicle-specific collection URLs when the user submits the form or uses the "Browse Catalog" fallback'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"key-logic-areas",children:"Key Logic Areas"}),"\n",(0,r.jsx)(s.h3,{id:"search-strategy-two-different-approaches",children:"Search Strategy: Two Different Approaches"}),"\n",(0,r.jsx)(s.p,{children:"The predictive search implements two distinct search strategies based on context:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"searchAllProducts()"})})," \u2014 Uses ",(0,r.jsx)(s.strong,{children:"Shopify Predictive Search API"})," (",(0,r.jsx)(s.code,{children:"/search/suggest"}),") to search across all products","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Used when: No vehicle is selected, or the query looks like a SKU/part number"}),"\n",(0,r.jsxs)(s.li,{children:["Returns: Server-rendered HTML from the ",(0,r.jsx)(s.code,{children:"predictive-search"})," section"]}),"\n",(0,r.jsx)(s.li,{children:"Behavior: Broad search across entire catalog, then optionally filtered by vehicle client-side"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"searchInCollection()"})})," \u2014 Uses ",(0,r.jsx)(s.strong,{children:"Fuse.js"})," for fuzzy matching within a specific vehicle collection","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Used when: A vehicle is selected and the query is not a SKU"}),"\n",(0,r.jsxs)(s.li,{children:["Returns: JSON product data from ",(0,r.jsx)(s.code,{children:"/collections/{handle}/products.json"})]}),"\n",(0,r.jsx)(s.li,{children:"Behavior: Scopes search to vehicle collection first, then uses Fuse.js for typo tolerance and fuzzy matching"}),"\n",(0,r.jsxs)(s.li,{children:["Fallback: If collection endpoint fails, falls back to ",(0,r.jsx)(s.code,{children:"searchAllProducts()"})," with client-side filtering"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This dual-strategy approach optimizes performance (by searching smaller vehicle-scoped collections) while maintaining broad coverage for SKU searches and users without selected vehicles."}),"\n",(0,r.jsx)(s.h3,{id:"header-integration-and-markup",children:"Header Integration and Markup"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The global header section renders the search bar through a ",(0,r.jsx)(s.code,{children:"render 'search-bar'"})," call."]}),"\n",(0,r.jsxs)(s.li,{children:["The search bar snippet outputs:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["A search ",(0,r.jsx)(s.code,{children:"<form>"})," tagged with ",(0,r.jsx)(s.code,{children:"data-predictive-search-form"})," and ",(0,r.jsx)(s.code,{children:"data-live-search-form"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["An ",(0,r.jsx)(s.code,{children:"<input>"})," tagged with ",(0,r.jsx)(s.code,{children:"data-predictive-search-input"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["A results container tagged with ",(0,r.jsx)(s.code,{children:"data-predictive-search-results"})," that starts hidden and is controlled entirely by JavaScript."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"These data attributes are the contract between Liquid markup and the predictive search JavaScript."}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"predictive-search-section-server-side",children:"Predictive Search Section (Server-Side)"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The predictive search section uses the ",(0,r.jsx)(s.code,{children:"predictive_search"})," object to build grouped result lists for:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Query suggestions and collections"}),"\n",(0,r.jsx)(s.li,{children:"Products"}),"\n",(0,r.jsx)(s.li,{children:"Pages and articles"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["Each product result ",(0,r.jsx)(s.code,{children:"<li>"})," encodes fitment-related metadata:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"data-fitment-collections"})," \u2014 a pipe-delimited list of collection titles the product belongs to (used to infer vehicle collections)."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"data-collection-types"})," \u2014 value of ",(0,r.jsx)(s.code,{children:"product.metafields.custom.collection_types"})," serialized for client-side filtering."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:'The section also renders a "View all results" button that submits the sanitized search terms to the full search page.'}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"client-side-predictive-search-behavior",children:"Client-Side Predictive Search Behavior"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["A dedicated JavaScript asset initializes predictive search on page load by:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Locating the header search ",(0,r.jsx)(s.code,{children:"<form>"}),", input, and results container via ",(0,r.jsx)(s.code,{children:"data-predictive-search-*"})," attributes."]}),"\n",(0,r.jsx)(s.li,{children:"Debouncing user input (400ms) before triggering search."}),"\n",(0,r.jsx)(s.li,{children:"Rendering a loading skeleton state while waiting for responses."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Search routing logic:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Detects if the query looks like a SKU (alphanumeric, 6-20 chars, no spaces, contains both letters and numbers)."}),"\n",(0,r.jsxs)(s.li,{children:["If SKU-like OR no vehicle is selected \u2192 calls ",(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"searchAllProducts()"})})," which uses ",(0,r.jsx)(s.strong,{children:"Shopify Predictive Search API"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["If vehicle is selected AND not a SKU \u2192 calls ",(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"searchInCollection()"})})," which uses ",(0,r.jsx)(s.strong,{children:"Fuse.js"})," for fuzzy matching within the vehicle collection."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Result rendering:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["For ",(0,r.jsx)(s.code,{children:"searchAllProducts()"}),": Injects server-rendered HTML from the ",(0,r.jsx)(s.code,{children:"predictive-search"})," section."]}),"\n",(0,r.jsxs)(s.li,{children:["For ",(0,r.jsx)(s.code,{children:"searchInCollection()"}),': Builds product tiles from JSON data client-side, including "Did you mean?" suggestions extracted from Fuse.js results.']}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:['The script also normalizes search text (e.g., handling "and" vs ',(0,r.jsx)(s.code,{children:"&"}),") and implements typo correction by analyzing character frequency in matched product titles."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"vehicle-scoped-fitment-filtering",children:"Vehicle-Scoped Fitment Filtering"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The script reads the selected vehicle from EasySearch / garage via ",(0,r.jsx)(s.code,{children:"localStorage.searchTerms"})," and caches it."]}),"\n",(0,r.jsxs)(s.li,{children:["When predictive search results are present, it:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Parses ",(0,r.jsx)(s.code,{children:"data-fitment-collections"})," and ",(0,r.jsx)(s.code,{children:"data-collection-types"})," on each product result."]}),"\n",(0,r.jsx)(s.li,{children:"Compares the selected vehicle YMM (year/make/model) to the vehicle collections and collection types associated with each product."}),"\n",(0,r.jsx)(s.li,{children:"Hides products that do not match the current vehicle and tracks how many matching products remain."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["If no vehicle is selected, the script:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Avoids fitment-based filtering."}),"\n",(0,r.jsx)(s.li,{children:'Injects a non-blocking reminder banner prompting the user to "Select Vehicle" via the EasySearch button.'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["If a vehicle is selected but no products match fitment:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:'Renders a "no fitment" state explaining that no parts were found for that vehicle and query.'}),"\n",(0,r.jsx)(s.li,{children:'Offers a "Browse Catalog" button that links to the vehicle\'s collection URL derived from the stored YMM.'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"search-submission-urls-and-logging",children:"Search Submission, URLs, and Logging"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["On submit, the script:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Waits for any in-flight input handling to finish."}),"\n",(0,r.jsx)(s.li,{children:"Chooses between searching all products or within a vehicle-specific collection, based on the selected vehicle and inferred product type."}),"\n",(0,r.jsx)(s.li,{children:"Constructs URLs that may include collection-type filters and product-type filters when appropriate."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["It logs search behavior (query, vehicle context, matches) to Google Sheets using ",(0,r.jsx)(s.code,{children:"sendBeacon"})," so navigation does not block logging."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"high-level-flow-diagram",children:"High-Level Flow Diagram"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-text",children:'User types in header search\n  \u2193\nsnippets/search-bar.liquid\n  - Renders search form + input + results container\n  - Adds data-predictive-search-* attributes\n  \u2193\nassets/predictive-search.js\n  - Listens to input (debounced)\n  - Reads EasySearch vehicle from localStorage.searchTerms\n  - Detects if query looks like a SKU\n  \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 BRANCH: Search Strategy Decision                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                              \u2502\n\u2502  Is SKU? OR No vehicle selected?                            \u2502\n\u2502                                                              \u2502\n\u2502  YES \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    NO \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502                              \u2193                             \u2193 \u2502\n\u2502  searchAllProducts()         \u2502    searchInCollection()    \u2502 \u2502\n\u2502  - Shopify Predictive Search \u2502    - Fuse.js fuzzy search  \u2502 \u2502\n\u2502  - /search/suggest endpoint  \u2502    - /collections/{handle}/\u2502 \u2502\n\u2502  - Server-rendered HTML      \u2502      products.json         \u2502 \u2502\n\u2502  - Broad catalog search      \u2502    - Vehicle-scoped first  \u2502 \u2502\n\u2502                              \u2502    - JSON product data     \u2502 \u2502\n\u2502                              \u2502    - Client-side rendering \u2502 \u2502\n\u2502                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                         \u2193                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n  \u2193\nsections/predictive-search.liquid (if Shopify Predictive Search)\n  - Uses predictive_search object to render server-side HTML\n  - Adds data-fitment-collections + data-collection-types to each product\n  \u2193\nassets/predictive-search.js\n  - Injects HTML (from Shopify) OR builds HTML (from Fuse.js results)\n  - Filters products by vehicle fitment (if applicable)\n  - Shows vehicle reminders / no-fitment / errors / "did you mean" suggestions\n  \u2193\nNavigation\n  - User clicks a product, suggestion, or "View all results" / "Browse Catalog"\n  - JS builds filtered URLs using collection types + product type\n  - Logs search analytics to Google Sheets via sendBeacon\n'})}),"\n",(0,r.jsx)(s.h2,{id:"known-constraints--gotchas",children:"Known Constraints & Gotchas"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Hard dependency on Fuse.js library"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The ",(0,r.jsx)(s.code,{children:"searchInCollection()"})," function requires Fuse.js to be loaded on the page for fuzzy matching and typo tolerance. If Fuse.js is missing or fails to load, vehicle-scoped searches will fail silently or fall back to exact matching only."]}),"\n",(0,r.jsx)(s.li,{children:"Fuse.js configuration (threshold, keys, weights) is hardcoded in the JavaScript and affects search quality."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Dual search strategy creates complexity"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Two different search paths (",(0,r.jsx)(s.code,{children:"searchAllProducts()"})," using Shopify API vs ",(0,r.jsx)(s.code,{children:"searchInCollection()"})," using Fuse.js) mean debugging search issues requires identifying which code path was taken."]}),"\n",(0,r.jsxs)(s.li,{children:["SKU detection logic determines which path is used, so changes to ",(0,r.jsx)(s.code,{children:"looksLikeSKU()"})," can unexpectedly shift behavior between Shopify and Fuse.js searches."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Hard dependency on EasySearch / garage state"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Vehicle-scoped behavior assumes ",(0,r.jsx)(s.code,{children:"localStorage.searchTerms"})," exists and follows the expected structure. If this shape changes, fitment filtering will silently break."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Fitment based on collection titles and metafields"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Fitment filtering depends on collection naming conventions and ",(0,r.jsx)(s.code,{children:"product.metafields.custom.collection_types"}),". Renaming collections or changing metafield formats without updating the logic can cause incorrect matches or missed products."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Predictive Search section contract"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The JavaScript expects predictive search results (from ",(0,r.jsx)(s.code,{children:"searchAllProducts()"}),") to include ",(0,r.jsx)(s.code,{children:"data-fitment-collections"})," and ",(0,r.jsx)(s.code,{children:"data-collection-types"})," attributes. Removing or renaming these breaks vehicle filtering while leaving basic search functional."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"GraphQL and API dependencies"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Collection-type enrichment and some URL-building behavior depend on Shopify GraphQL. API failures degrade behavior to more generic searching."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Localization and money formats"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"The predictive search section uses translated strings and money formats provided by theme settings and locales. Changes in translation keys or formats can affect rendering but not core logic."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"safe-to-change",children:"Safe to Change"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Visual styling of the header search input, buttons, and results layout (CSS-only changes)."}),"\n",(0,r.jsx)(s.li,{children:"Copy and microcopy inside predictive search messages (e.g., instructions, error text), as long as IDs and data attributes remain intact."}),"\n",(0,r.jsxs)(s.li,{children:["Non-behavioral refactors inside the JavaScript that do not alter:","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Data attributes (",(0,r.jsx)(s.code,{children:"data-predictive-search-*"}),", ",(0,r.jsx)(s.code,{children:"data-fitment-collections"}),", ",(0,r.jsx)(s.code,{children:"data-collection-types"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"LocalStorage key names."}),"\n",(0,r.jsx)(s.li,{children:"URL-building rules."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.li,{children:"Adding additional analytics or logging that does not change existing payload shapes or event timing."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"dangerous-to-change",children:"Dangerous to Change"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"SKU detection logic"})," (",(0,r.jsx)(s.code,{children:"looksLikeSKU()"}),") \u2014 Changes affect which search strategy (Shopify API vs Fuse.js) is used, potentially breaking part number searches."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Search routing decision tree"})," \u2014 Logic that decides between ",(0,r.jsx)(s.code,{children:"searchAllProducts()"})," and ",(0,r.jsx)(s.code,{children:"searchInCollection()"})," based on vehicle state and SKU detection."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fuse.js configuration"})," \u2014 Threshold values, search keys, and weights directly affect search quality and relevance for vehicle-scoped searches."]}),"\n",(0,r.jsxs)(s.li,{children:["LocalStorage keys and structure used for vehicle selection (especially ",(0,r.jsx)(s.code,{children:"localStorage.searchTerms"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"The way vehicle collection handles are derived from YMM strings (year/make/model) when building URLs."}),"\n",(0,r.jsxs)(s.li,{children:["The rules that map predictive search products to vehicles via collections and ",(0,r.jsx)(s.code,{children:"product.metafields.custom.collection_types"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["The data attributes used by the JavaScript (",(0,r.jsx)(s.code,{children:"data-predictive-search-form"}),", ",(0,r.jsx)(s.code,{children:"data-predictive-search-input"}),", ",(0,r.jsx)(s.code,{children:"data-predictive-search-results"}),", ",(0,r.jsx)(s.code,{children:"data-fitment-collections"}),", ",(0,r.jsx)(s.code,{children:"data-collection-types"}),")."]}),"\n",(0,r.jsx)(s.li,{children:"Network call shapes and endpoints for Shopify Predictive Search, Shopify Collections API, and GraphQL without updating all consumers."}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"related-files",children:"Related Files"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"sections/static-header.liquid"})," (renders the global header and invokes the search bar snippet)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"snippets/search-bar.liquid"})," (header search input, buttons, and results container markup)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"sections/predictive-search.liquid"})," (server-side predictive search section consumed by ",(0,r.jsx)(s.code,{children:"searchAllProducts()"}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"assets/predictive-search.js"})," (client-side predictive search behavior and vehicle fitment filtering)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"assets/predictive-search.css"})," (styles for predictive search skeleton, errors, and messaging)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"layout/theme.liquid"})," (loads predictive search CSS/JS assets and Fuse.js library into the storefront)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Fuse.js library"})," (external dependency loaded via CDN, required for ",(0,r.jsx)(s.code,{children:"searchInCollection()"})," fuzzy matching)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"snippets/rimg.liquid"}),", ",(0,r.jsx)(s.code,{children:"snippets/product-price.liquid"}),", ",(0,r.jsx)(s.code,{children:"snippets/product-stock-level.liquid"})," (product card rendering used inside predictive search results)"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"snippets/search-sanitizer.liquid"}),' (sanitizes search terms for "view all results" behavior)']}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"snippets/easysearch-garage.liquid"})," and related EasySearch assets (vehicle selection UI and localStorage state)"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"owner--maintenance",children:"Owner & Maintenance"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Owner:"})," Wyatt C."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Last Updated:"})," 2026-01-12"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);